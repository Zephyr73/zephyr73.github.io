name: Build and deploy 11ty to GitHub Pages

on:
	push:
		branches: [ main ]

permissions:
	contents: read
	pages: write
	id-token: write

jobs:
	build-and-deploy:
		runs-on: ubuntu-latest
		steps:
			- name: Checkout
				uses: actions/checkout@v4

			- name: Setup Node.js
				uses: actions/setup-node@v4
				with:
					node-version: '20'

			- name: Install dependencies
				run: npm ci

			- name: Build CSS
				run: npm run build:css

			- name: Build Eleventy site
				run: npx @11ty/eleventy --input . --output _site

			- name: Deploy to gh-pages
				uses: peaceiris/actions-gh-pages@v3
				with:
					github_token: ${{ secrets.GITHUB_TOKEN }}
					publish_dir: ./_site

